# API Keys Setup Guide for ABBIS

## Overview

ABBIS uses **two different types of keys**:

1. **Encryption Key** (Generated by ABBIS) - Used to encrypt your API keys
2. **API Keys** (From external services like OpenAI) - Your actual service credentials

---

## Step 1: Set Up the Encryption Key (Required First)

The encryption key is generated by ABBIS and is used to **encrypt and protect** your API keys before storing them in the database.

### Where to Set It Up:
- **Page**: `modules/admin/setup-encryption-key.php`
- **Or**: Click the "ğŸ” Set up encryption key now" button in AI Governance if you see a warning

### How to Use It:
1. Go to **System â†’ Admin â†’ Setup Encryption Key** (or use the modal from AI Governance)
2. Click **"ğŸ² Generate Encryption Key"**
3. Click **"ğŸ’¾ Save to File"** to save it automatically
   - OR copy the key and set it as an environment variable (for production)

### What It Does:
- The encryption key is used **automatically** by ABBIS to encrypt your API keys
- You **don't manually use** this key anywhere - ABBIS uses it behind the scenes
- Once set up, you can proceed to add your OpenAI API key

---

## Step 2: Add Your OpenAI API Key

After the encryption key is configured, you can add your OpenAI API key.

### Where to Add It:
- **Page**: `modules/ai-governance.php` (AI Governance & Audit)
- **Navigation**: System â†’ AI Governance

### Step-by-Step:
1. Go to **AI Governance & Audit** page
2. In the **"ğŸ¤– AI Provider Setup"** section:
   - Select **"OpenAI"** from the dropdown
   - Scroll down to find the **"API Key"** field (under OpenAI settings)
   - Enter your OpenAI API key (starts with `sk-...`)
   - Optionally set:
     - **Default Model** (e.g., `gpt-4`, `gpt-3.5-turbo`)
     - **Base URL** (leave blank for default OpenAI endpoint)
     - **Request Timeout** (default: 30 seconds)
3. Set **Usage Limits** (optional):
   - Daily Limit
   - Monthly Limit
4. Set **Backup Priority** (1 = primary, higher = backup)
5. Click **"Save Provider Settings"**

### What Happens:
- Your OpenAI API key is **automatically encrypted** using the encryption key
- The encrypted key is stored securely in the database
- ABBIS will use this key when making AI requests

---

## Visual Guide

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Setup Encryption Key                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ modules/admin/setup-encryption-key.php            â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  [Generate Key] â†’ [Save to File]                 â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  Result: Encryption key saved                     â”‚  â”‚
â”‚  â”‚  (Used automatically by ABBIS)                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: Add OpenAI API Key                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ modules/ai-governance.php                         â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  Select: OpenAI                                   â”‚  â”‚
â”‚  â”‚  Enter: Your OpenAI API Key (sk-...)              â”‚  â”‚
â”‚  â”‚  [Save Provider Settings]                         â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  Result: API key encrypted & stored               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Quick Reference

| Key Type | Where to Get It | Where to Put It | Purpose |
|----------|----------------|-----------------|---------|
| **Encryption Key** | Generated by ABBIS | `setup-encryption-key.php` | Encrypts API keys |
| **OpenAI API Key** | From OpenAI.com | `ai-governance.php` | Authenticates with OpenAI |

---

## Security Notes

1. **Encryption Key**:
   - Never commit to version control
   - Back it up securely
   - If lost, all encrypted API keys become unrecoverable

2. **OpenAI API Key**:
   - Always encrypted before storage
   - Never displayed in plain text
   - Can be updated anytime in AI Governance

---

## Troubleshooting

### "Encryption Key Not Configured" Error
- **Solution**: Go to `setup-encryption-key.php` and generate/save the encryption key first

### "Failed to save API key"
- **Check**: Is the encryption key configured?
- **Check**: Are file permissions correct for the secrets directory?

### API Key Not Working
- **Verify**: Your OpenAI API key is valid and has credits
- **Check**: Usage limits haven't been exceeded
- **Verify**: The model name is correct (e.g., `gpt-4`, `gpt-3.5-turbo`)

---

## Need Help?

- **Encryption Key Issues**: See `docs/AI_ASSISTANT_TROUBLESHOOTING.md`
- **AI Governance**: Check the help tooltips (?) on the AI Governance page
- **API Key Format**: OpenAI keys start with `sk-` followed by alphanumeric characters
